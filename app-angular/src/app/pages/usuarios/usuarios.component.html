<app-evento-titulo *ngIf="id_evento" [idEvento]="id_evento"></app-evento-titulo>

<mat-card class="cardWithShadow">
  <mat-card-content class="p-24">
    <div class="row justify-content-between">
      <div class="col-lg-4">
        <mat-form-field appearance="outline" class="w-100 hide-hint">
          <input
            matInput
            placeholder="Buscar usuario"
            (keyup)="applyFilter($any($event.target).value)"
          />
          <mat-icon matSuffix>
            <i-tabler name="search" class="icon-20"></i-tabler>
          </mat-icon>
        </mat-form-field>
      </div>
      <div class="col-lg-4 d-flex align-items-center justify-content-end">
        <button
          mat-flat-button
          (click)="openNuevoUsuario('crearNuevoUsuario', 'a')"
          color="primary"
        >
          {{ textoBotonUsuario }}
        </button>
      </div>
    </div>
  </mat-card-content>
</mat-card>
<mat-card class="cardWithShadow">
  <mat-card-content class="p-24">
    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" class="w-100">
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Usuario
          </th>
          <td mat-cell *matCellDef="let usuario" class="f-s-14">
            {{ usuario.nombreCompleto }}
          </td>
        </ng-container>

        <ng-container matColumnDef="correo">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Correo
          </th>
          <td mat-cell *matCellDef="let usuario" class="f-s-14">
            {{ usuario.correo }}
          </td>
        </ng-container>

        <ng-container matColumnDef="rol">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">Rol</th>
          <td mat-cell *matCellDef="let usuario" class="f-s-14">
            {{ usuario.nombre_rol }}
          </td>
        </ng-container>

        <!--          <ng-container matColumnDef="curp">-->
        <!--            <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600"> CURP</th>-->
        <!--            <td mat-cell *matCellDef="let usuario" class="f-s-14"> {{ usuario.curp }}</td>-->
        <!--          </ng-container>-->

        <ng-container matColumnDef="telefono">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Teléfono
          </th>
          <td mat-cell *matCellDef="let usuario" class="f-s-14">
            {{ usuario.telefono }}
          </td>
        </ng-container>

        <!-- Evento (solo visible para rol 27) -->
        <ng-container matColumnDef="evento" *ngIf="clave_rol_usuario === 27">
          <th mat-header-cell *matHeaderCellDef> Evento </th>
          <td mat-cell *matCellDef="let element">
            {{ element.nombre_evento }}
          </td>
        </ng-container>




        <ng-container matColumnDef="estatus">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Estatus
          </th>
          <td mat-cell *matCellDef="let usuario" class="f-s-14">
            {{ usuario.nombre_estatus }}
          </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef class="f-s-16 f-w-600">
            Acciones
          </th>
          <td mat-cell *matCellDef="let usuario" class="action-link">
            <a
              [ngClass]="{ 'disabled-link': usuario.clave_estatus === 2 }"
              class="m-r-10 cursor-pointer"
              [matTooltip]="
                usuario.nombre_estatus === 'Deshabilitado'
                  ? 'No se puede actualizar si el usuario está deshabilitado'
                  : 'Actualizar usuario'
              "
              (click)="openNuevoUsuario('editarUsuario', usuario)"
            >
              <i-tabler name="edit" class="icon-18"></i-tabler>
            </a>
            <a
              [ngClass]="{ 'disabled-link': usuario.clave_estatus === 2 }"
              class="m-r-10 cursor-pointer"
              [matTooltip]="
                usuario.nombre_estatus === 'Deshabilitado'
                  ? 'No se puede cambiar la contraseña si el usuario está deshabilitado'
                  : 'Cambiar contraseña'
              "
              (click)="openNuevoUsuario('cambiarContrasena', usuario)"
            >
              <i-tabler name="key" class="icon-18"></i-tabler>
            </a>
            <a
              class="m-r-10 cursor-pointer"
              [matTooltip]="
                usuario.nombre_estatus === 'Deshabilitado'
                  ? 'Habilitar'
                  : 'Deshabilitar'
              "
              (click)="openNuevoUsuario('cambiarEstatus', usuario)"
            >
              <i-tabler name="refresh" class="icon-18"></i-tabler>
            </a>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          [ngClass]="{ 'disabled-row': row.clave_estatus === 2 }"
        ></tr>
      </table>
      <mat-paginator
        [pageSizeOptions]="[10, 20, 30]"
        showFirstLastButtons
      ></mat-paginator>
    </div>
  </mat-card-content>
</mat-card>
